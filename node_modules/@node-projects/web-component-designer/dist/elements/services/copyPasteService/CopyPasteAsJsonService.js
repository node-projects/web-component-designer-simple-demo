import { DomConverter } from "../../widgets/designerView/DomConverter.js";
import { copyToClipboard, getFromClipboard, getTextFromClipboard } from "../../helper/ClipboardHelper.js";
export class CopyPasteAsJsonService {
    async copyItems(designItems) {
        const copyText = DomConverter.ConvertToString(designItems, false);
        const positions = designItems.map(x => x.instanceServiceContainer.designerCanvas.getNormalizedElementCoordinates(x.element));
        let data = { html: copyText, positions: positions };
        copyToClipboard([["application/json", JSON.stringify(data)]]);
    }
    async getPasteItems(serviceContainer, instanceServiceContainer) {
        let data = '';
        let html = '';
        let positions = null;
        const items = await getFromClipboard();
        if (items != null) {
            try {
                data = await (await items[0].getType('text/html'))?.text();
            }
            catch { }
            if (!data)
                try {
                    data = await (await items[0].getType('text/plain'))?.text();
                }
                catch { }
            try {
                data = await (await items[0].getType('application/json'))?.text();
            }
            catch { }
        }
        else {
            data = await getTextFromClipboard();
        }
        if (data.startsWith('{')) {
            let dataObj = JSON.parse(data);
            html = dataObj.html;
            positions = dataObj.positions;
        }
        else {
            html = data;
        }
        const parserService = serviceContainer.htmlParserService;
        return [await parserService.parse(html, serviceContainer, instanceServiceContainer, true), positions];
    }
}
